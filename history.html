<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>Visualized Chrome History</title>
  <link rel="stylesheet" type="text/css" href="assets/styles/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="assets/scripts/chronoline/jquery.qtip.min.css" />
  <link rel="stylesheet" type="text/css" href="assets/scripts/chronoline/chronoline.css" />
  <link rel="stylesheet" type="text/css" href="assets/styles/site.css" />
  <script type="text/javascript" src="assets/scripts/jquery-1.7.2.min.js"></script>  
  <script type="text/javascript" src="assets/scripts/chronoline/jquery.qtip.min.js"></script>
  <script type="text/javascript" src="assets/scripts/chronoline/raphael-min.js"></script>
  <script type="text/javascript" src="assets/scripts/chronoline/chronoline.js"></script>
  <script type="text/javascript" src="assets/scripts/chrome_history.js"></script>
  <script type="text/javascript" src="assets/scripts/URI.min.js"></script>
  <script type="text/javascript" src="chrome_ex_oauthsimple.js"></script>
  <script type="text/javascript" src="chrome_ex_oauth.js"></script>
  <script type="text/javascript">
  $(document).ready(function() {
    // set #timeline half height of window
    $("#timeline, #search").css('height', window.screen.height / 2);
    $("#icon, #result").css('height', $(window).height() - $("#timeline").height());
    // calculate timeline canvas top margin.
    var heiStr = $('#timeline').css('height');
    heiStr = heiStr.substring(0, heiStr.length - 2);
    heiInt = parseInt(heiStr);
    heiInt = heiInt - 80;
    
    var today = new Date();
    stripTime(today);
    // TODO: change maxResults after developing process.
    chrome.history.search({
      'text': '',
      'startTime': today.getTime(),
      'endTime': today.getTime() + DAY_IN_MILLISECONDS,
      'maxResults': 800
    }, function(result) {
      var data = {};
      var events = [];
      result.forEach(function(r) {
        var event = null;
        var uri = URI(r.url);
        var key = uri.scheme() + '://' + uri.host();
        if(data[key]) {
          data[key].count += 1;
        } else {
            event = {
              dates: [new Date(r.lastVisitTime)],
              title: r.title,
              icon: 'chrome://favicon/' + r.url,
              count: 1
              };
            data[key] = event;
        }
      });
      for(var url in data) {
        events.push(data[url]);
      }
      var timeline = Chronoline.create(document.getElementById("timeline"), events, {
        animated: true,
        tooltips: true,
        topMargin: heiInt,
        scrollable: false,
        startDate: new Date(),
        subSubLabelAttrs: {'font-size': '18pt'},
        mode: CHRONOLINE_MODE.HOUR_DAY
      });

    });
  });
  </script>
</head>
<body>
  <div class="container container-fluid">
    <div class="row-fluid">
      <div id="search" class="span2 right-line">
<!--         <form id="serch-form" method="post" action class="search-field-container"> -->
          <input type="search" id="search-field">
          <input type="submit" name="search" value="Search history" id="search-button">
<!--         </form> -->
        <ol id="catalog" style="list-style:none;">
          <li>
            <input type="checkbox" name="gmail" value="gmail" id="gmail">
            <label for="gmail">
              <img src="assets/images/gmail.png"> Gmail</img>
            </label>
          </li>
          <li>
            <input type="checkbox" name="bookmarks" value="bookmarks" id="bookmarks">
            <label for="bookmarks">
              <img src="assets/images/bookmarks.png"> Bookmarks</img>
            </label>
          </li>
          <li>
            <input type="checkbox" name="calendar" value="calendar" id="calendar">
            <label for="calendar">
              <img src="assets/images/calendar.png"> Calendar</img>
            </label>
          </li>
          <li>
            <input type="checkbox" name="history" value="history" id="history">
            <label for="history">
              <img src="assets/images/history.png"> History</img>
            </label>
          </li>
          <li>
            <input type="checkbox" name="place" value="place" id="place">
            <label for="place">
              <img src="assets/images/place.png"> Place</img>
            </label>
          </li>
          <li>
            <input type="checkbox" name="contact" value="contact" id="contact">
            <label for="contact">
              <img src="assets/images/contact.png"> Contact</img>
            </label>
          </li>
        </ol>
      </div>
      <div id="timeline" class="span10">
      </div>
    </div>
    <hr>
    <div class="row-fluid">
      <div id="icon" class="span2 right-line">
        <h3>Icon Cloud</h3>
      </div>
      <div id="result" class="span9">
        <h3>Result</h3>
        <ol id="result-list">
        </ol>
      </div>
    </div>
  </div>
</body>
</html>
